    [Qemu-devel] [PATCH 2/2] Revert "ehci: make idt processing more robust"

------------------------------------------------------------------------
*From*: 	Gerd Hoffmann
*Subject*: 	[Qemu-devel] [PATCH 2/2] Revert "ehci: make idt processing
more robust"
*Date*: 	Mon, 18 Apr 2016 11:27:23 +0200

------------------------------------------------------------------------

This reverts commit 156a2e4dbffa85997636a7a39ef12da6f1b40254.

Breaks freebsd.
---
 tools/qemu-xen/hw/usb/hcd-ehci.c | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/tools/qemu-xen/hw/usb/hcd-ehci.c b/tools/qemu-xen/hw/usb/hcd-ehci.c
index 923f110..7add81c 100644
--- a/tools/qemu-xen/hw/usb/hcd-ehci.c
+++ b/tools/qemu-xen/hw/usb/hcd-ehci.c
@@ -1397,7 +1397,7 @@ static int ehci_process_itd(EHCIState *ehci,
 {
     USBDevice *dev;
     USBEndpoint *ep;
-    uint32_t i, len, pid, dir, devaddr, endp, xfers = 0;
+    uint32_t i, len, pid, dir, devaddr, endp;
     uint32_t pg, off, ptr1, ptr2, max, mult;
 
     ehci->periodic_sched_active = PERIODIC_ACTIVE;
@@ -1489,10 +1489,9 @@ static int ehci_process_itd(EHCIState *ehci,
                 ehci_raise_irq(ehci, USBSTS_INT);
             }
             itd->transact[i] &= ~ITD_XACT_ACTIVE;
-            xfers++;
         }
     }
-    return xfers ? 0 : -1;
+    return 0;
 }
 
 
-- 
1.8.3.1

